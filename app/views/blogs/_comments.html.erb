<%# Renders the comments section for a blog post
# -params-
# blog: the blog post
-%>

<% responses = blog.comments.size %>
<div id="commentContainer">
	<h2><%= pluralize(responses, 'response') %> to <%= blog.title %></h2>
	<% if responses > 0 %>
		<ul class="comments_body">
			<% blog.comments.each do |comment| %>
				<% next unless comment.approved || (blog_logged_in? && current_user.can_moderate_blog_comments?(blog.blog_set_id)) %>
				<%= render :partial => 'blog_comments/show', :locals => { :comment => comment } %>
			<% end %>
		</ul>
	<% else %>
		<p>No comments have been made on this blog.</p>
	<% end %>
	<% if blog_logged_in? %>
		<% if blog.comments_closed? %>
			<p>Comments have been closed for this blog.</p>
		<% else %>
			<h3>Leave a Reply</h3>
			<div style="padding:5px;">
				Logged in as <%= current_user.display_name %><br />
				<%= render :partial => 'blog_comments/new', :locals => { :blog => blog } %>
			</div>
		<% end %>
	<% end %>
<br/>
</div>
